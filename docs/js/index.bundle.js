!function(){"use strict";function e(e,a,t){const n=document.createElement(e);return n.className=a,t.append(n),n}function a(e){const a=e.getDate(),t=e.toLocaleString("ru-Ru",{weekday:"short"});let n=!1;return"вс"!==t&&"сб"!==t||(n=!0),`\n    <span class="page-nav__day-week ${n?"page-nav__day_weekend":""}">${t}</span>\n    <span class="page-nav__day-number ${n?"page-nav__day_weekend":""}">${a}</span>\n  `}function t(e,a,t,n){e.dataset.year=a,e.dataset.month=t,e.dataset.day=n}const n={pageNav:document.querySelector(".page-nav"),main:document.querySelector(".main")},s=new Date,i=s.getFullYear(),l=s.getMonth(),c=s.getDate();let o=s.getFullYear(),r=s.getMonth(),_=s.getDate(),d={movieName:"",hallName:"",hallId:"",hallConfig:"",priceStandart:"",priceVip:"",seanceId:"",seanceTime:"",seanceStart:"",seanceDay:""};const m=e("a","page-nav__day page-nav__day_today page-nav__day_chosen",n.pageNav);m.href="#",m.innerHTML=a(new Date),t(m,i,l,c);for(let s=1;s<=6;s++){const o=e("a","page-nav__day",n.pageNav);o.href="#",o.innerHTML=a(new Date(i,l,c+s)),t(o,i,l,c+s)}const v=Array.from(document.querySelectorAll(".page-nav__day"));v.forEach((e=>{e.addEventListener("click",(a=>{a.preventDefault(),v.forEach((e=>{e.classList.remove("page-nav__day_chosen")})),e.classList.add("page-nav__day_chosen"),o=e.dataset.year,r=e.dataset.month,_=e.dataset.day,document.querySelectorAll(".movie-seances__time-button").forEach((e=>{const a=e.querySelector(".movie-seances__time").textContent.split(":"),t=new Date(i,l,c,a[0],a[1]);e.disabled=s.getTime()>t.getTime()&&Number(_)===c}))}))})),async function(){const a=await fetch("https://jscp-diplom.netoserver.ru/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"event=update"}),t=await a.json(),m=t.films.result,v=t.seances.result,p=t.halls.result;m.forEach((a=>{const t=e("section","movie",n.main);t.dataset.id=a.film_id,e("div","movie__info",t).innerHTML=`\n        <div class="movie__poster">\n          <img\n            class="movie__poster-image"\n            alt="${a.film_name} постер"\n            src="${a.film_poster}"\n          />\n        </div>\n        <div class="movie__description">\n          <h2 class="movie__title">\n            ${a.film_name}\n          </h2>\n          <p class="movie__synopsis">\n            ${a.film_description}\n          </p>\n          <p class="movie__data">\n            <span class="movie__data-duration">${a.film_duration} минуты</span>\n            <span class="movie__data-origin">${a.film_origin}</span>\n          </p>\n          <div class="movie-seances__halls-list"></div>\n        </div>\n      `;const m=v.filter((e=>e.seance_filmid===a.film_id));p.forEach((a=>{if("1"===a.hall_open){const n=m.filter((e=>e.seance_hallid===a.hall_id)),o=t.querySelector(".movie-seances__halls-list");if(n.length>0){const t=e("div","movie-seances__hall",o);t.innerHTML=`<h3 class="movie-seances__hall-title" data-id=${a.hall_id}>Зал ${a.hall_name.slice(3)}</h3>`;const r=e("ul","movie-seances__list",t);n.forEach((a=>{const t=a.seance_time.split(":"),n=new Date(i,l,c,t[0],t[1]),o=e("li","movie-seances__time-block",r),d=e("button","movie-seances__time-button",o);d.disabled=s.getTime()>n.getTime()&&Number(_)===c,d.innerHTML=`<a class="movie-seances__time" href="hall.html" data-seance-start=${a.seance_start} data-seance-id=${a.seance_id}>${a.seance_time}</a>`}))}}})),Array.from(document.querySelectorAll(".movie-seances__time")).forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const a=e.target.closest(".movie").querySelector(".movie__title"),t=e.target.closest(".movie-seances__hall").querySelector(".movie-seances__hall-title"),n=Math.trunc(Number(e.target.dataset.seanceStart)/60),s=Number(e.target.dataset.seanceStart)%60,i=new Date(o,r,_,n,s);let l="",c="",m="";p.forEach((e=>{e.hall_id===t.dataset.id&&(l=e.hall_config,c=e.hall_price_standart,m=e.hall_price_vip)})),d.movieName=a.textContent.trim(),d.hallName=t.textContent.trim(),d.hallId=t.dataset.id,d.hallConfig=l,d.priceStandart=c,d.priceVip=m,d.seanceId=e.target.dataset.seanceId,d.seanceTime=e.target.textContent.trim(),d.seanceStart=String(i.getTime()/1e3),d.seanceDay=i.toLocaleString("ru-Ru",{dateStyle:"short"}),localStorage.setItem("selectedMovie",JSON.stringify(d))}))}))}))}()}();