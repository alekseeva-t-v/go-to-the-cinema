!function(){"use strict";function e(e,t,a){const n=document.createElement(e);return n.className=t,a.append(n),n}function t(e){const t=e.getDate(),a=e.toLocaleString("ru-Ru",{weekday:"short"});let n=!1;return"вс"!==a&&"сб"!==a||(n=!0),`\n    <span class="page-nav__day-week ${n?"page-nav__day_weekend":""}">${a}</span>\n    <span class="page-nav__day-number ${n?"page-nav__day_weekend":""}">${t}</span>\n  `}function a(e,t,a,n){e.dataset.year=t,e.dataset.month=a,e.dataset.day=n}const n={pageNav:document.querySelector(".page-nav"),main:document.getElementById("main"),preloader:document.querySelector(".main--skeleton"),buyingSeanceTitle:document.querySelector(".buying__info-title"),buyingSeanceStart:document.querySelector(".buying__info-start"),buyingSeanceHall:document.querySelector(".buying__info-hall"),confStep:document.querySelector(".conf-step"),confStepWrapper:document.querySelector(".conf-step__wrapper"),priceStandart:document.querySelector(".price-standart"),priceVip:document.querySelector(".price-vip"),acceptinLink:document.querySelector(".acceptin-link"),acceptinButton:document.querySelector(".acceptin-button"),ticketTitle:document.querySelector(".ticket__title"),ticketChairs:document.querySelector(".ticket__chairs"),ticketHall:document.querySelector(".ticket__hall"),ticketStart:document.querySelector(".ticket__start"),ticketCost:document.querySelector(".ticket__cost"),ticketTitle:document.querySelector(".ticket__title"),ticketChairs:document.querySelector(".ticket__chairs"),ticketHall:document.querySelector(".ticket__hall"),ticketStart:document.querySelector(".ticket__start"),ticketInfoQr:document.querySelector(".ticket__info-qr")};document.addEventListener("DOMContentLoaded",(()=>{localStorage.removeItem("selectedMovie")}));const c=new Date,i=c.getFullYear(),o=c.getMonth(),r=c.getDate();let s=c.getFullYear(),l=c.getMonth(),_=c.getDate(),d={movieName:"",hallName:"",hallId:"",hallConfig:"",priceStandart:"",priceVip:"",seanceId:"",seanceTime:"",seanceStart:"",seanceDay:""};const m=e("a","page-nav__day page-nav__day_today page-nav__day_chosen",n.pageNav);m.href="#",m.innerHTML=t(new Date),a(m,i,o,r);for(let c=1;c<=6;c++){const s=e("a","page-nav__day",n.pageNav);s.href="#",s.innerHTML=t(new Date(i,o,r+c)),a(s,i,o,r+c)}const u=Array.from(document.querySelectorAll(".page-nav__day"));u.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),u.forEach((e=>{e.classList.remove("page-nav__day_chosen")})),e.classList.add("page-nav__day_chosen"),s=e.dataset.year,l=e.dataset.month,_=e.dataset.day,document.querySelectorAll(".movie-seances__time-button").forEach((e=>{const t=e.querySelector(".movie-seances__time").textContent.split(":"),a=new Date(i,o,r,t[0],t[1]);e.disabled=c.getTime()>a.getTime()&&Number(_)===r}))}))})),async function(){try{const t=await fetch("https://jscp-diplom.netoserver.ru/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"event=update"});if(!t.ok)throw new Error("Something went wrong...");const a=await t.json(),m=a.films.result,u=a.seances.result,p=a.halls.result;m.forEach((t=>{const a=e("section","movie",n.main);a.dataset.id=t.film_id,e("div","movie__info",a).innerHTML=`\n        <div class="movie__poster">\n          <img\n            class="movie__poster-image"\n            alt="${t.film_name} постер"\n            src="${t.film_poster}"\n          />\n        </div>\n        <div class="movie__description">\n          <h2 class="movie__title">\n            ${t.film_name}\n          </h2>\n          <p class="movie__synopsis">\n            ${t.film_description}\n          </p>\n          <p class="movie__data">\n            <span class="movie__data-duration">${t.film_duration} минуты</span>\n            <span class="movie__data-origin">${t.film_origin}</span>\n          </p>\n          <div class="movie-seances__halls-list"></div>\n        </div>\n      `,n.preloader.remove(),n.main.style.opacity=1;const m=u.filter((e=>e.seance_filmid===t.film_id));p.forEach((t=>{if("1"===t.hall_open){const n=m.filter((e=>e.seance_hallid===t.hall_id)),s=a.querySelector(".movie-seances__halls-list");if(n.length>0){const a=e("div","movie-seances__hall",s);a.innerHTML=`<h3 class="movie-seances__hall-title" data-id=${t.hall_id}>Зал ${t.hall_name.slice(3)}</h3>`;const l=e("ul","movie-seances__list",a);n.forEach((t=>{const a=t.seance_time.split(":"),n=new Date(i,o,r,a[0],a[1]),s=e("li","movie-seances__time-block",l),d=e("button","movie-seances__time-button",s);d.disabled=c.getTime()>n.getTime()&&Number(_)===r,d.innerHTML=`<a class="movie-seances__time" href="hall.html" data-seance-start=${t.seance_start} data-seance-id=${t.seance_id}>${t.seance_time}</a>`}))}}})),Array.from(document.querySelectorAll(".movie-seances__time")).forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".movie").querySelector(".movie__title"),a=e.target.closest(".movie-seances__hall").querySelector(".movie-seances__hall-title"),n=Math.trunc(Number(e.target.dataset.seanceStart)/60),c=Number(e.target.dataset.seanceStart)%60,i=new Date(s,l,_,n,c);let o="",r="",m="";p.forEach((e=>{e.hall_id===a.dataset.id&&(o=e.hall_config,r=e.hall_price_standart,m=e.hall_price_vip)})),d.movieName=t.textContent.trim(),d.hallName=a.textContent.trim(),d.hallId=a.dataset.id,d.hallConfig=o,d.priceStandart=r,d.priceVip=m,d.seanceId=e.target.dataset.seanceId,d.seanceTime=e.target.textContent.trim(),d.seanceStart=String(i.getTime()/1e3),d.seanceDay=i.toLocaleString("ru-Ru",{dateStyle:"short"}),localStorage.setItem("selectedMovie",JSON.stringify(d))}))}))}))}catch{console.log(error)}}()}();