!function(){"use strict";function e(e,t,a){const n=document.createElement(e);return n.className=t,a.append(n),n}function t(e){const t=e.getDate(),a=e.toLocaleString("ru-Ru",{weekday:"short"});let n=!1;return"вс"!==a&&"сб"!==a||(n=!0),`\n    <span class="page-nav__day-week ${n?"page-nav__day_weekend":""}">${a}</span>\n    <span class="page-nav__day-number ${n?"page-nav__day_weekend":""}">${t}</span>\n  `}function a(e,t,a,n){e.dataset.year=t,e.dataset.month=a,e.dataset.day=n}const n={pageNav:document.querySelector(".page-nav"),main:document.querySelector(".main"),buyingSeanceTitle:document.querySelector(".buying__info-title"),buyingSeanceStart:document.querySelector(".buying__info-start"),buyingSeanceHall:document.querySelector(".buying__info-hall"),confStepWrapper:document.querySelector(".conf-step__wrapper"),priceStandart:document.querySelector(".price-standart"),priceVip:document.querySelector(".price-vip"),acceptinLink:document.querySelector(".acceptin-link"),acceptinButton:document.querySelector(".acceptin-button"),ticketTitle:document.querySelector(".ticket__title"),ticketChairs:document.querySelector(".ticket__chairs")};document.addEventListener("DOMContentLoaded",(()=>{localStorage.removeItem("selectedMovie")}));const i=new Date,s=i.getFullYear(),c=i.getMonth(),o=i.getDate();let l=i.getFullYear(),r=i.getMonth(),d=i.getDate(),_={movieName:"",hallName:"",hallId:"",hallConfig:"",priceStandart:"",priceVip:"",seanceId:"",seanceTime:"",seanceStart:"",seanceDay:""};const m=e("a","page-nav__day page-nav__day_today page-nav__day_chosen",n.pageNav);m.href="#",m.innerHTML=t(new Date),a(m,s,c,o);for(let i=1;i<=6;i++){const l=e("a","page-nav__day",n.pageNav);l.href="#",l.innerHTML=t(new Date(s,c,o+i)),a(l,s,c,o+i)}const u=Array.from(document.querySelectorAll(".page-nav__day"));u.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),u.forEach((e=>{e.classList.remove("page-nav__day_chosen")})),e.classList.add("page-nav__day_chosen"),l=e.dataset.year,r=e.dataset.month,d=e.dataset.day,document.querySelectorAll(".movie-seances__time-button").forEach((e=>{const t=e.querySelector(".movie-seances__time").textContent.split(":"),a=new Date(s,c,o,t[0],t[1]);e.disabled=i.getTime()>a.getTime()&&Number(d)===o}))}))})),async function(){const t=await fetch("https://jscp-diplom.netoserver.ru/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"event=update"}),a=await t.json();console.log(a);const m=a.films.result,u=a.seances.result,p=a.halls.result;m.forEach((t=>{const a=e("section","movie",n.main);a.dataset.id=t.film_id,e("div","movie__info",a).innerHTML=`\n        <div class="movie__poster">\n          <img\n            class="movie__poster-image"\n            alt="${t.film_name} постер"\n            src="${t.film_poster}"\n          />\n        </div>\n        <div class="movie__description">\n          <h2 class="movie__title">\n            ${t.film_name}\n          </h2>\n          <p class="movie__synopsis">\n            ${t.film_description}\n          </p>\n          <p class="movie__data">\n            <span class="movie__data-duration">${t.film_duration} минуты</span>\n            <span class="movie__data-origin">${t.film_origin}</span>\n          </p>\n          <div class="movie-seances__halls-list"></div>\n        </div>\n      `;const m=u.filter((e=>e.seance_filmid===t.film_id));p.forEach((t=>{if("1"===t.hall_open){const n=m.filter((e=>e.seance_hallid===t.hall_id)),l=a.querySelector(".movie-seances__halls-list");if(n.length>0){const a=e("div","movie-seances__hall",l);a.innerHTML=`<h3 class="movie-seances__hall-title" data-id=${t.hall_id}>Зал ${t.hall_name.slice(3)}</h3>`;const r=e("ul","movie-seances__list",a);n.forEach((t=>{const a=t.seance_time.split(":"),n=new Date(s,c,o,a[0],a[1]),l=e("li","movie-seances__time-block",r),_=e("button","movie-seances__time-button",l);_.disabled=i.getTime()>n.getTime()&&Number(d)===o,_.innerHTML=`<a class="movie-seances__time" href="hall.html" data-seance-start=${t.seance_start} data-seance-id=${t.seance_id}>${t.seance_time}</a>`}))}}})),Array.from(document.querySelectorAll(".movie-seances__time")).forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".movie").querySelector(".movie__title"),a=e.target.closest(".movie-seances__hall").querySelector(".movie-seances__hall-title"),n=Math.trunc(Number(e.target.dataset.seanceStart)/60),i=Number(e.target.dataset.seanceStart)%60,s=new Date(l,r,d,n,i);let c="",o="",m="";p.forEach((e=>{e.hall_id===a.dataset.id&&(c=e.hall_config,o=e.hall_price_standart,m=e.hall_price_vip)})),_.movieName=t.textContent.trim(),_.hallName=a.textContent.trim(),_.hallId=a.dataset.id,_.hallConfig=c,_.priceStandart=o,_.priceVip=m,_.seanceId=e.target.dataset.seanceId,_.seanceTime=e.target.textContent.trim(),_.seanceStart=String(s.getTime()/1e3),_.seanceDay=s.toLocaleString("ru-Ru",{dateStyle:"short"}),localStorage.setItem("selectedMovie",JSON.stringify(_))}))}))}))}()}();